.TH mfscli "1" "February 2025" "MooseFS 4.57.5-1" "This is part of MooseFS"
.SH NAME
mfscli - CGI in TXT mode
.SH SYNOPSIS
\fBmfscli\fP [\fB-jpn28\fP] [\fB-H\fP \fImaster_host\fP] [\fB-P\fP \fImaster_port\fP]
[\fB-f\fP \fI0..3\fP] \fB-S(IN|IM|LI|IG|MU|IC|IL|MF|CS|MB|HD|EX|MS|RS|SC|PA|OF|AL|MO|QU|MC|CC)\fP
[\fB-s\fP \fIseparator\fP] [\fB-o\fP \fIorder_id\fP [\fB-r\fP]] [\fB-m\fP \fImode_id\fP]
[\fB-i\fP \fIid\fP] [\fB-a\fP \fImaster_data_count\fP] [\fB-b\fP \fImaster_data_desc\fP] [\fB-c\fP \fIchunkserver_data_count\fP] [\fB-d\fP \fIchunkserver_data_desc\fP]
.PP
\fBmfscli\fP [\fB-pn28\fP] [\fB-H\fP \fImaster_host\fP] [\fB-P\fP \fImaster_port\fP]
[\fB-f\fP \fI0..3\fP]
\fB-C\fP(\fBRC/\fP\fIip\fP\fB/\fP\fIport\fP|\fBBW/\fP\fIip\fP\fB/\fP\fIport\fP|\fBM[01]/\fP\fIip\fP\fB/\fP\fIport\fP|\fBRS/\fP\fIsessionid\fP|\fBTR/\fP\fIip\fP\fB/\fP\fIport\fP)
.PP
\fBmfscli\fP \fB-h\fP
.SH DESCRIPTION
\fBmfscli\fP is a commandline counterpart to MooseFS's CGI interface. All the information available
in CGI (except for graphs) can be obtained via CLI using different "monitoring options"
.SH OPTIONS
.TP
\fB-h\fP
print help message and exit
.TP
\fB-j\fP
print result in JSON format
.TP
\fB-p\fP
force plain text format on tty devices
.TP
\fB-n\fP
do not resolve ip addresses (default when output device is not tty)
.TP
\fB-s\fP \fIseparator\fP
field separator to use in plain text format on tty devices (forces \fB-p\fP)
.TP
\fB-2\fP
force 256-color terminal color codes
.TP
\fB-8\fP
force 8-color terminal color codes
.TP
\fB-H\fP \fImaster_host\fP
master address (default: mfsmaster)
.TP
\fB-P\fP \fImaster_port\fP
master client port (default: 9421)
.TP
\fB-f\fP \fB0\fP..\fB3\fP
set frame charset to be displayed as table frames in ttymode;
.RS
.IP 0
simple ascii frames '+','-','|' (default)
.IP 1
thick unicode frames
.IP 2
thin unicode frames
.IP 3
double unicode frames (dos style)
.RE
.TP
\fB-o\fP \fIorder_id\fP
sort data by column specified by 'order id' (depends on data set)
.TP
\fB-r\fP
reverse sort order
.TP
\fB-m\fP \fImode_id\fP
show data specified by 'mode id' (depends on data set)
.TP
\fB-i\fP \fIid\fP
sessionid for \fB-SOF\fP or inode for \fB-SAL\fP
.TP
\fB-a\fP \fImaster_data_count\fP
how many chart entries should be shown for master (-SMC)
.TP
\fB-b\fP \fImaster_data_desc\fP
define chart columns for master; prefix with '+' for raw data, (pro only) prefix with 'ip:[port:]' for server choice (by default leader master will be used); use 'all' as a chart name for all available charts
.TP
\fB-c\fP \fIchunkserver_data_count\fP
how many chart entries should be shown for chunkserver
.TP
\fB-d\fP \fIchunkserver_data_desc\fP
define chart columns for chunkserver; prefix with '+' for raw data, prefix with 'ip:[port:]' for server choice (by default all servers will be used); use 'all' as a chart name for all available charts
.SH MONITORING OPTIONS
.TP
\fB-SIN\fP
show full master info
.TP
\fB-SIM\fP
show only masters states
.TP
\fB-SLI\fP
(pro only) show only licence info
.TP
\fB-SIG\fP
show only general master (in pro version: leader) info
.TP
\fB-SMU\fP
show only master memory usage
.TP
\fB-SIC\fP
show only chunks info (goal/copies matrices)
.TP
\fB-SIL\fP
show only loop info (with messages)
.TP
\fB-SMF\fP
show only missing chunks/files (report from last full chunk loop)
.TP
\fB-SCS\fP
show connected chunk servers
.TP
\fB-SMB\fP
show connected metadata backup servers
.TP
\fB-SHD\fP
show hdd data
.TP
\fB-SEX\fP
show exports
.TP
\fB-SMS\fP
show active mounts
.TP
\fB-SRS\fP
show resources (storage classes,patterns,open files,acquired locks)
.TP
\fB-SSC\fP
show storage classes info
.TP
\fB-SPA\fP
show patterns override data
.TP
\fB-SOF\fP
show only open files
.TP
\fB-SAL\fP
show only acquired locks
.TP
\fB-SMO\fP
show operation counters
.TP
\fB-SQU\fP
show quota info
.TP
\fB-SMC\fP
show master charts data
.TP
\fB-SCC\fP
show chunkserver charts data
.SH MASTER CHART DATA COLUMNS
.TP 14
ucpu
User cpu usage
.TP
scpu
System cpu usage
.TP
delete,del
Number of chunk deletion attempts
.TP
replicate,rep,repl
Number of chunk replication attempts
.TP
statfs
Number of statfs operations
.TP
getattr
Number of getattr operations
.TP
setattr
Number of setattr operations
.TP
lookup
Number of lookup operations
.TP
mkdir
Number of mkdir operations
.TP
rmdir
Number of rmdir operations
.TP
symlink
Number of symlink operations
.TP
readlink
Number of readlink operations
.TP
mknod
Number of mknod operations
.TP
unlink
Number of unlink operations
.TP
rename
Number of rename operations
.TP
link
Number of link operations
.TP
readdir
Number of readdir operations
.TP
open
Number of open operations
.TP
readchunk
Number of chunk_read operations
.TP
writechunk
Number of chunk_write operations
.TP
memoryrss,memrss,rmem,mem
Resident memory usage
.TP
prcvd
Received packets
.TP
psent
Sent packets
.TP
brcvd
Received bytes
.TP
bsent
Sent bytes
.TP
memoryvirt,memvirt,vmem
Virtual memory usage
.TP
usedspace
RAW disk space usage
.TP
totalspace
RAW disk space connected
.TP
create
Number of chunk creation attempts
.TP
change
Number of chunk internal operation attempts
.TP
delete_ok
Number of successful chunk deletions
.TP
delete_err
Number of unsuccessful chunk deletions
.TP
replicate_ok
Number of successful chunk replications
.TP
replicate_err
Number of unsuccessful chunk replications
.TP
create_ok
Number of successful chunk creations
.TP
create_err
Number of unsuccessful chunk creations
.TP
change_ok
Number of successful chunk internal operations
.TP
change_err
Number of unsuccessful chunk internal operations
.TP
split_ok
Number of successful chunk split operations
.TP
split_err
Number of unsuccessful chunk split operations
.TP
fileobjects
Number of file objects
.TP
metaobjects
Number of non-file objects (directories,symlinks,etc.)
.TP
chunksec8
Total number of chunks stored in EC8 format
.TP
chunksec4
Total number of chunks stored in EC4 format
.TP
chunkscopy
Total number of chunks stored in COPY format
.TP
chregdanger
Number of endangered chunks (mark for removal excluded)
.TP
chregunder
Number of undergoal chunks (mark for removal excluded)
.TP
challdanger
Number of endangered chunks (mark for removal included)
.TP
challunder
Number of undergoal chunks (mark for removal included)
.TP
bytesread
Average number of bytes read per second by all clients
.TP
byteswrite
Average number of bytes written per second by all clients
.TP
read
Number of read operations
.TP
write
Number of write operations
.TP
fsync
Number of fsync operations
.TP
lock
Number of lock operations
.TP
snapshot
Number of snapshot operations
.TP
truncate
Number of truncate operations
.TP
getxattr
Number of getxattr operations
.TP
setxattr
Number of setxattr operations
.TP
getfacl
Number of getfacl operations
.TP
setfacl
Number of setfacl operations
.TP
fcreate
Number of file create operations
.TP
meta
Number of extra metadata operations (sclass,trashretention,eattr etc.)
.TP
delay
(pro only) Master max delay in seconds
.TP
servers
Number of all registered chunk servers (both connected and disconnected)
.TP
mdservers
Number of disconnected chunk servers that are in maintenance mode
.TP
dservers
Number of disconnected chunk servers that are not in maintenance mode
.TP
udiff
Difference in space usage percent between the most and least used chunk server
.TP
cpu
Total cpu usage (scpu + ucpu)
.SH CHUNKSERVER CHART DATA COLUMNS
.TP 14
ucpu
User cpu usage
.TP
scpu
System cpu usage
.TP
masterin
Data received from master
.TP
masterout
Data sent to master
.TP
csrepin
Data received by replicator
.TP
csrepout
Data sent by replicator
.TP
csservin
Data received by csserv
.TP
csservout
Data sent by csserv
.TP
hdrbytesr
Bytes read (headers)
.TP
hdrbytesw
Bytes written (headers)
.TP
hdrllopr
Low level reads (headers)
.TP
hdrllopw
Low level writes (headers)
.TP
databytesr
Bytes read (data)
.TP
databytesw
Bytes written (data)
.TP
datallopr
Low level reads (data)
.TP
datallopw
Low level writes (data)
.TP
hlopr
High level reads
.TP
hlopw
High level writes
.TP
rtime
Read time
.TP
wtime
Write time
.TP
repl
Replicate chunk ops
.TP
create
Create chunk ops
.TP
delete
Delete chunk ops
.TP
version
Set version ops
.TP
duplicate
Duplicate ops
.TP
truncate
Truncate ops
.TP
duptrunc
Duptrunc (duplicate+truncate) ops
.TP
test
Test chunk ops
.TP
load
Server load
.TP
memoryrss,memrss,rmem,mem
Resident memory usage
.TP
memoryvirt,memvirt,vmem
Virtual memory usage
.TP
movels
Low speed move ops
.TP
movehs
High speed move ops
.TP
split
Split ops
.TP
usedspace
Used HDD space in bytes (mark for removal excluded)
.TP
totalspace
Total HDD space in bytes (mark for removal excluded)
.TP
chunkcount
Number of stored chunks (mark for removal excluded)
.TP
tdusedspace
Used HDD space in bytes on disks marked for removal
.TP
tdtotalspace
Total HDD space in bytes on disks marked for removal
.TP
tdchunkcount
Number of chunks stored on disks marked for removal
.TP
copychunks
Number of chunks stored in copy format (all disks)
.TP
ec4chunks
Number of chunk parts stored in EC4 format (all disks)
.TP
ec8chunks
Number of chunk parts stored in EC8 format (all disks)
.TP
hddok
Number of valid folders (hard drives)
.TP
hddmfr
Number of folders (hard drives) that are marked for removal
.TP
hdddmg
Number of folders (hard drives) that are marked as damaged
.TP
udiff
Difference in usage percent between the most and least used disk
.TP
cpu
Total cpu usage (scpu + ucpu)
.SH COMMANDS
.TP
\fB-CRC/\fP\fIip\fP\fB/\fP\fIport\fP
remove selected chunkserver from list of active chunkservers
.TP
\fB-CTR/\fP\fIip\fP\fB/\fP\fIport\fP
temporarily remove selected chunkserver from list of active chunkservers (master elect only)
.TP
\fB-CBW/\fP\fIip\fP\fB/\fP\fIport\fP
send selected chunkserver back to work state (from grace state)
.TP
\fB-CM1/\fP\fIip\fP\fB/\fP\fIport\fP
switch selected chunkserver to maintenance mode
.TP
\fB-CM0/\fP\fIip\fP\fB/\fP\fIport\fP
switch selected chunkserver to standard mode (from maintenance mode)
.TP
\fB-CRS/\fP\fIsessionid\fP
remove selected session
.SH EXAMPLES
.IP "\fBmfscli -SIC -2\fP"
shows table with chunk state matrix (number of chunks for each combination of valid copies and goal set by user) using extended terminal colors (256-colors)
.IP "\fBmfscli -SCS -f 1\fP"
shows table with all chunkservers using unicode thick frames
.IP "\fBmfscli -SMS -p -s ','\fP"
shows current sessions (mounts) using plain text format and coma as a separator
.IP "\fBmfscli -SOF -i 123\fP"
shows files open by processes using session (mount) with id 123
.IP "\fBmfscli -SMC -a 10 -b cpu,memoryrss,delete,replicate\fP"
shows master cpu usage, amount of resident memory used by master,
number of chunk deletions and number of chunk replications during last ten minutes
.IP "\fBmfscli -SCC -c 15 -d 192.168.1.10:9422:cpu,192.168.1.11:9422:cpu\fP"
shows cpu usage of chunkservers located on machines with IP 192.168.1.10 and 192.168.1.11
during last fifteen minutes
.IP "\fBmfscli -SCC -d $(mfscli -SCS -p -s ',' | grep '^chunk' | awk -F ',' 'BEGIN {s=""""} {printf ""%s%s:%s:mem"",s,$2,$3 ; s="",""}')\fP"
shows resident memory usage of all connected chunkservers (old mfscli - before version 4.32.2)
.IP "\fBmfscli -SCC -d mem\fP"
shows resident memory usage of all connected chunkservers (current mfscli)
.IP "\fBmfscli -SIN -j\fP"
prints basic infos in JSON format
.SH "REPORTING BUGS"
Report bugs to <bugs@moosefs.com>.
.SH COPYRIGHT
Copyright (C) 2025 Jakub Kruszona-Zawadzki, Saglabs SA

This file is part of MooseFS.

MooseFS is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, version 2 (only).

MooseFS is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with MooseFS; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02111-1301, USA
or visit http://www.gnu.org/licenses/gpl-2.0.html
.SH "SEE ALSO"
.BR mfsmaster (8)
